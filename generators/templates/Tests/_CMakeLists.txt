<% packages.forEach(function(pkg) { -%>
find_package(<%= pkg.name %><%_ if (pkg.config) { %> CONFIG<% } %> <%_ if (pkg.required) { %> REQUIRED<% } %>)
<% }) -%>

file(GLOB_RECURSE <%= cmake_prefix %>_TEST_SOURCES
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= source_prefix %>/*.h"
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= source_prefix %>/*.cc"
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= source_prefix %>/**/*.h"
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= source_prefix %>/**/*.cc")

add_executable(<%= module_name %>
  main.cc
  ${<%= cmake_prefix %>_TEST_SOURCES})
target_include_directories(<%= module_name %> PUBLIC ${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR})
target_compile_options(<%= module_name %>
  PUBLIC ${<%= cmake_prefix %>_COMPILE_OPTIONS})
target_link_libraries(<%= module_name %>
  <%= library_name -%>
  <%_ packages.forEach(function(pkg) { -%>
    <%_ if(pkg.link) { -%>
    <%_ pkg.link.forEach(function(lib) { -%>
  <%- lib -%>
    <%_ }) -%>
    <%_ } -%>
  <%_ }) -%>)

<%_ if(coverage) { -%>
if(ENABLE_COVERAGE)
  create_coverage_target(<%= module_name %> ${PRT_SOU})
endif()
<%_ } -%>
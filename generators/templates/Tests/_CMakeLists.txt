<% packages.forEach(function(pkg) { -%>
find_package(<%= pkg.name %><%_ if (pkg.config) { %> CONFIG<% } %> <%_ if (pkg.required) { %> REQUIRED<% } %>)
<% }) -%>

file(GLOB_RECURSE <%= prefix %>_TEST_SOURCES
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= project_name %>/*.h"
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= project_name %>/*.cc"
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= project_name %>/**/*.h"
  "${CMAKE_CURRENT_SOURCE_DIR}/<%= project_name %>/**/*.cc")

add_executable(<%= module_name %>
  main.cc
  ${<%= prefix %>_TEST_SOURCES})
target_compile_options(<%= module_name %>
  PRIVATE ${<%= prefix %>_COMPILE_OPTIONS})
target_link_libraries(<%= module_name %>
  <%= lib_name -%>
  <%_ packages.forEach(function(pkg) { -%>
    <%_ if(pkg.link) { -%>
    <%_ pkg.link.forEach(function(lib) { -%>
  <%- lib -%>
    <%_ }) -%>
    <%_ } -%>
  <%_ }) -%>)